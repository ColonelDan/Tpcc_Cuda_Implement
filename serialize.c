#include <stdio.h>  
#include <string.h>  
#include <stdlib.h>

#define RECORD_MAX_SIZE 10
#define RECORD_MAX_LENGTH 1000

// define warehouse 
// primary :W_ID
struct warehouse//?????????????????????????????????
{	
	long W_ID ; //warehous id. 		
	char W_NAME[10+1] ; // warehouse name.
	char W_STREET_1[20+1] ; // address 1.
	char W_STREET_2[20+1] ; // address 2.
	char W_CITY[20+1]	; // city.
	char W_STATE[2+1] ; // state.
	char W_ZIP[9+1] ; // zip number.
	double W_TAX ; // sale tax.
	double W_YTD ; // year to date balance.
};

int main(int argc, const char * argv[]) {  
    
    char file_name[] = "c_warehouse.csv";  //?????????????????????????????????
    FILE *fp;  
    fp = fopen(file_name, "r");  
      
    if (!fp) {  
        fprintf(stderr, "failed to open file for reading\n");  
        return -1;  
    }
    
    char c;
    int i=0;
    int index=0;
    
    char **record_arr;
    record_arr=malloc(RECORD_MAX_SIZE*sizeof(char *));
    record_arr[index]=malloc(RECORD_MAX_LENGTH*sizeof(char));
    
    while(1){
      c=fgetc(fp);
      if(c==EOF){
        break;
      }
      if(c=='\n'){
        record_arr[index][i++]='\0';
        index++;
        record_arr[index]=malloc(RECORD_MAX_LENGTH*sizeof(char));
        i=0;
      }else{
        if(c!='"'){
          record_arr[index][i++]=c;
        }
      }
    }
    
    struct warehouse *warehouse_arr;//?????????????????????????????????
    warehouse_arr=malloc(index*sizeof(struct warehouse));//?????????????????????????????????
    
    for(i=1;i<index;i++){
      //printf("%s\n",record_arr[i]);
      char *token;
      
      token=strtok(record_arr[i],",");
      warehouse_arr[i].W_ID=atol(token);//?????????????????????????????????
      
      token=strtok(NULL, ",");
      strcpy(warehouse_arr[i].W_NAME,token);//?????????????????????????????????
      
      token=strtok(NULL, ",");
      strcpy(warehouse_arr[i].W_STREET_1,token);//?????????????????????????????????
	  
	  token=strtok(NULL, ",");
      strcpy(warehouse_arr[i].W_STREET_2,token);//?????????????????????????????????
	  
	  token=strtok(NULL, ",");
      strcpy(warehouse_arr[i].W_CITY,token);//?????????????????????????????????
	  
	  token=strtok(NULL, ",");
      strcpy(warehouse_arr[i].W_STATE,token);//?????????????????????????????????
	  
	  token=strtok(NULL, ",");
      strcpy(warehouse_arr[i].W_ZIP,token);//?????????????????????????????????
	  
	  token=strtok(NULL, ",");
      warehouse_arr[i].W_TAX=atof(token);//?????????????????????????????????
	  
	  token=strtok(NULL, ",");
      warehouse_arr[i].W_YTD=atof(token);//?????????????????????????????????
      
      token=strtok(NULL, ",");
      
      //printf("!!!!!!!!!!!!!!!!\n%ld\n%s\n%s\n%s\n%s\n%s\n%s\n%lf\n%lf\n",warehouse_arr[i].W_ID,warehouse_arr[i].W_NAME,
	  //		warehouse_arr[i].W_STREET_1,warehouse_arr[i].W_STREET_2,warehouse_arr[i].W_CITY,warehouse_arr[i].W_STATE,
	  //		warehouse_arr[i].W_ZIP,warehouse_arr[i].W_TAX,warehouse_arr[i].W_YTD);
    }
     
      
    fclose (fp);  
      
    return 0;  
}  
