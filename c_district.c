#include <stdio.h>  
#include <string.h>  
#include <stdlib.h>

#define RECORD_MAX_SIZE 100
#define RECORD_MAX_LENGTH 200

// define distric
// primary key: D_W_ID. D_ID
// D_W_ID foreign key. references W_ID
struct district
{
	long D_ID; 
	long D_W_ID; // reference to warehouse.
	char D_NAME[10+5]; 
	char D_STREET_1[10+5];
	char D_STREET_2[20+5];
	char D_CITY[20+5];
	char D_STATE[2+5];
	char D_ZIP[9+5];
	double D_TAX;
	double D_YTD;
	
	long D_NEXT_O_ID ; //next order id.
};

static int get_district(struct district **p_district_arr){ //?????????????????????????????????
	char file_name[] = "c_district.csv";  //?????????????????????????????????
    FILE *fp;  
    fp = fopen(file_name, "r");  
      
    if (!fp) {  
        fprintf(stderr, "failed to open file for reading\n");  
        return -1;  
    }
    
    char c;
    int i=0;
    int index=0;
    
    char **record_arr;
    record_arr=malloc(RECORD_MAX_SIZE*sizeof(char *));
    record_arr[index]=malloc(RECORD_MAX_LENGTH*sizeof(char));
    
    while(1){
      c=fgetc(fp);
      if(c==EOF){
        break;
      }
      if(c=='\n'){
        record_arr[index][i++]='\0';
        index++;
        record_arr[index]=malloc(RECORD_MAX_LENGTH*sizeof(char));
        i=0;
      }else{
        if(c!='"'){
          record_arr[index][i++]=c;
        }
      }
    }

    *p_district_arr=(struct district *)malloc(index*sizeof(struct district));//?????????????????????????????????
    
     
    
    for(i=1;i<index;i++){
      //printf("%s\n",record_arr[i]);
      char *token;
      
      token=strtok(record_arr[i],",");
      (*p_district_arr)[i].D_ID=atol(token);//?????????????????????????????????
      
      token=strtok(NULL,",");
      (*p_district_arr)[i].D_W_ID=atol(token);//?????????????????????????????????

      token=strtok(NULL, ",");
      strcpy((*p_district_arr)[i].D_NAME,token);//?????????????????????????????????

      token=strtok(NULL, ",");
      strcpy((*p_district_arr)[i].D_STREET_1,token);//?????????????????????????????????

	  token=strtok(NULL, ",");
      strcpy((*p_district_arr)[i].D_STREET_2,token);//?????????????????????????????????
	  
	  token=strtok(NULL, ",");
      strcpy((*p_district_arr)[i].D_CITY,token);//?????????????????????????????????
	  
	  token=strtok(NULL, ",");
      strcpy((*p_district_arr)[i].D_STATE,token);//?????????????????????????????????
	  
	  token=strtok(NULL, ",");
      strcpy((*p_district_arr)[i].D_ZIP,token);//?????????????????????????????????
	  
	  token=strtok(NULL, ",");
      (*p_district_arr)[i].D_TAX=atof(token);//?????????????????????????????????
	  
	  token=strtok(NULL, ",");
      (*p_district_arr)[i].D_YTD=atof(token);//?????????????????????????????????
      
      token=strtok(NULL,",");
      (*p_district_arr)[i].D_NEXT_O_ID=atol(token);//?????????????????????????????????
      
      token=strtok(NULL,",");
    }
     
    fclose (fp);  
    
    return index;
}

int main(int argc, const char * argv[]) {  
    
    struct district *district_arr;//?????????????????????????????????
    int index=get_district(&district_arr);//?????????????????????????????????
    int i;
    for(i=1;i<index;i++){ //?????????????????????????????????
		printf("!!!!!!!!!!!!!!!!\n%ld\n%ld\n%s\n%s\n%s\n%s\n%s\n%s\n%lf\n%lf\n%ld\n",district_arr[i].D_ID,district_arr[i].D_W_ID,district_arr[i].D_NAME,
	  		district_arr[i].D_STREET_1,district_arr[i].D_STREET_2,district_arr[i].D_CITY,district_arr[i].D_STATE,
	  		district_arr[i].D_ZIP,district_arr[i].D_TAX,district_arr[i].D_YTD,district_arr[i].D_NEXT_O_ID);
	}
      
    return 0;  
}  
