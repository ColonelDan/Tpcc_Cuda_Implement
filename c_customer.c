#include <stdio.h>  
#include <string.h>  
#include <stdlib.h>

#define RECORD_MAX_SIZE 300000
#define RECORD_MAX_LENGTH 800

// define customer 
// primary :W_ID
// define customer
struct customer
{
        long C_ID ;
        long C_D_ID ;
        long C_W_ID ;
        char C_FIRST[16+1] ;//  first name .
        char C_MIDDLE[2+1] ; // middle name.
        char C_LAST[16+1] ; // last name.
        char C_STREET_1[20+1] ; //
        char C_STREET_2[20+1] ; //
        char C_CITY[20+1] ; //
        char C_STATE[2+1] ;
        char C_ZIP[9+1] ;
        char C_PHONE[16+1] ;
        long C_SINCE ;  //register time.
        char C_CREDIT[2+1]; // "GC" = good , "BC" = bad
        double C_CREDIT_LIM; //
        double C_DISCOUNT ; //
        double C_BALANCE ;
        double C_YTD_PAYMENT;
        double C_PAYMENT_CNT;
        double C_DELIVERY_CNT;
        char C_DATA[500+1];       //
};

static int get_customer(struct customer **p_customer_arr){ //?????????????????????????????????
	char file_name[] = "C:\\Users\\Shinelon\\Desktop\\read csv\\read csv\\c_customer.csv";  //?????????????????????????????????
    FILE *fp;  
    fp = fopen(file_name, "r");  
      
    if (!fp) {  
        fprintf(stderr, "failed to open file for reading\n");  
        return -1;  
    }
    
    char c;
    int i=0;
    int index=0;
    
    char **record_arr;
    record_arr=malloc(RECORD_MAX_SIZE*sizeof(char *));
    record_arr[index]=malloc(RECORD_MAX_LENGTH*sizeof(char));
    
    while(1){
      c=fgetc(fp);
      if(c==EOF){
        break;
      }
      if(c=='\n'){
        record_arr[index][i++]='\0';
        index++;
        record_arr[index]=malloc(RECORD_MAX_LENGTH*sizeof(char));
        i=0;
      }else{
        if(c!='"'){
          record_arr[index][i++]=c;
        }
      }
    }

    *p_customer_arr=(struct customer *)malloc(index*sizeof(struct customer));//?????????????????????????????????
    
    for(i=1;i<index;i++){
      //printf("%s\n",record_arr[i]);
      char *token;
      
      token=strtok(record_arr[i],",");
      (*p_customer_arr)[i].C_ID=atol(token);//?????????????????????????????????
      
      token=strtok(NULL,",");
      (*p_customer_arr)[i].C_D_ID=atol(token);//?????????????????????????????????
      
      token=strtok(NULL,",");
      (*p_customer_arr)[i].C_W_ID=atol(token);//?????????????????????????????????
      
      token=strtok(NULL, ",");
      strcpy((*p_customer_arr)[i].C_FIRST,token);//?????????????????????????????????
      
      token=strtok(NULL, ",");
      strcpy((*p_customer_arr)[i].C_MIDDLE,token);//?????????????????????????????????
	  
	  token=strtok(NULL, ",");
      strcpy((*p_customer_arr)[i].C_LAST,token);//?????????????????????????????????
	  
	  token=strtok(NULL, ",");
      strcpy((*p_customer_arr)[i].C_STREET_1,token);//?????????????????????????????????
	  
	  token=strtok(NULL, ",");
      strcpy((*p_customer_arr)[i].C_STREET_2,token);//?????????????????????????????????
	  
	  token=strtok(NULL, ",");
      strcpy((*p_customer_arr)[i].C_CITY,token);//?????????????????????????????????
      
      token=strtok(NULL, ",");
      strcpy((*p_customer_arr)[i].C_STATE,token);//?????????????????????????????????
      
      token=strtok(NULL, ",");
      strcpy((*p_customer_arr)[i].C_ZIP,token);//?????????????????????????????????
      
      token=strtok(NULL, ",");
      strcpy((*p_customer_arr)[i].C_PHONE,token);//?????????????????????????????????
      
      token=strtok(NULL,",");
      (*p_customer_arr)[i].C_SINCE=1189;//!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
      
      token=strtok(NULL, ",");
      strcpy((*p_customer_arr)[i].C_CREDIT,token);//?????????????????????????????????
	  
	  token=strtok(NULL, ",");
      (*p_customer_arr)[i].C_CREDIT_LIM=atof(token);//?????????????????????????????????
	  
	  token=strtok(NULL, ",");
      (*p_customer_arr)[i].C_DISCOUNT=atof(token);//?????????????????????????????????
      
      token=strtok(NULL, ",");
      (*p_customer_arr)[i].C_BALANCE=atof(token);//?????????????????????????????????
	  
	  token=strtok(NULL, ",");
      (*p_customer_arr)[i].C_YTD_PAYMENT=atof(token);//?????????????????????????????????
	  
	  token=strtok(NULL, ",");
      (*p_customer_arr)[i].C_PAYMENT_CNT=atof(token);//?????????????????????????????????
	  
	  token=strtok(NULL, ",");
      (*p_customer_arr)[i].C_DELIVERY_CNT=atof(token);//?????????????????????????????????
      
      token=strtok(NULL, ",");
      strcpy((*p_customer_arr)[i].C_DATA,token);//?????????????????????????????????
      
      token=strtok(NULL, ",");
    }
     
    fclose (fp);  
    
    return index;
}

int main(int argc, const char * argv[]) {  
    
    struct customer *customer_arr;//?????????????????????????????????
    int index=get_customer(&customer_arr);//?????????????????????????????????
    int i;
    for(i=1;i<index;i++){ //?????????????????????????????????
		printf("%ld, %ld, %ld, %ld, %s, %s\n",
			customer_arr[i].C_ID,
			customer_arr[i].C_D_ID,
			customer_arr[i].C_W_ID,
			customer_arr[i].C_SINCE,
	  		customer_arr[i].C_STREET_1,
			customer_arr[i].C_ZIP);
	}
	char c;
	scanf("%c", &c);
      
    return 0;  
}  
